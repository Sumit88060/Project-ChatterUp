<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ChatterUp ðŸ’¬</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div class="main-container">
  <div class="chat-area">
    <div class="header">
      <span id="welcome-text"></span>
      <span id="typing-text"></span>
    </div>

    <div id="messages" class="messages-box"></div>

    <form id="chat-form">
      <input id="msg" type="text" placeholder="Enter message..." required />
      <button type="submit">Send</button>
    </form>
  </div>

  <div class="sidebar">
    <img id="my-avatar" src="/default.webp" />
    <input type="file" id="avatar-input" accept="image/*" />

    <h3>Users (<span id="count">0</span>)</h3>
    <ul id="users"></ul>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const username = prompt("Enter your name:");
  let profilePic = "/default.webp";

  document.getElementById("welcome-text").innerText = "Welcome " + username;
  socket.emit("join", username);

  document.getElementById("chat-form").addEventListener("submit", e => {
    e.preventDefault();
    const input = document.getElementById("msg");
    socket.emit("send-message", {
      user: username,
      text: input.value,
      profile: profilePic
    });
    input.value = "";
  });

  socket.on("message", data => {
    const div = document.createElement("div");
    div.innerHTML = `<strong>${data.username}</strong>: ${data.message}`;
    document.getElementById("messages").appendChild(div);
  });

  socket.on("user-list", users => {
    document.getElementById("count").innerText = users.length;
    const ul = document.getElementById("users");
    ul.innerHTML = "";
    users.forEach(u => {
      const li = document.createElement("li");
      li.innerText = u;
      ul.appendChild(li);
    });
  });

  document.getElementById("avatar-input").addEventListener("change", async e => {
    const formData = new FormData();
    formData.append("avatar", e.target.files[0]);

    const res = await fetch("/upload-avatar", {
      method: "POST",
      body: formData
    });

    const data = await res.json();
    document.getElementById("my-avatar").src = data.imageUrl;
    profilePic = data.imageUrl;
  });
</script>

</body>
</html>
